ARG PHP_VERSION
FROM php:$PHP_VERSION

RUN apt-get update && \
  apt-get install -y --no-install-recommends \
  git \
  unzip \
  wget \
  zip

WORKDIR /app

COPY . .
COPY --from=composer:2.2 /usr/bin/composer /usr/local/bin/composer

RUN cp .env.example .env
RUN composer install
RUN php artisan key:generate

# apply database migrations
# --force is required to create the database
RUN php artisan migrate --force --no-interaction

CMD ./run-fixture
